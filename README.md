# 麦麦自主规划插件

让麦麦拥有自己的生活日程，自动生成个性化的日常活动安排。

## ✨ 功能特性

- 🎯 **智能日程生成** - 使用 LLM 自动生成符合麦麦人格的每日活动
- 📅 **便捷查看** - 支持简洁和详细两种日程展示格式
- 🧹 **自动清理** - 一键清理旧日程，保持列表整洁
- 💬 **日程注入** - 麦麦会在对话中自然提到当前活动
- 🔄 **批量操作** - 优化的批量保存，性能更佳

## 🚀 快速开始

### 生成日程

对麦麦说：
```
"帮我生成今天的日程"
```

麦麦会自动创建一天的活动安排（起床、吃饭、学习、娱乐等）

### 查看日程

```bash
/plan status   # 查看简洁日程（时间线格式）
/plan list     # 查看详细日程（图片格式，含描述）
```

**示例输出：**
```
📅 今日日程

07:30-08:30 🏠 起床洗漱
08:30-09:00 🍽️ 吃早饭
09:00-11:00 📚 学习时间
12:00-13:00 🍽️ 吃午饭
14:00-16:00 📖 深度学习
18:00-19:00 🍽️ 吃晚饭
19:00-21:00 🎮 娱乐放松
23:00-23:30 🏠 准备睡觉
```

### 清理旧日程

```bash
/plan clear    # 清理昨天及更早的旧日程（保留今天的）
```

### 删除指定日程

```bash
/plan delete 3        # 删除第3个日程项
/plan delete abc-123  # 删除指定ID的日程
```

## 📋 命令列表

| 命令 | 说明 |
|------|------|
| `/plan status` | 查看今日日程概览（简洁时间线） |
| `/plan list` | 查看今日日程详情（图片格式） |
| `/plan clear` | 清理昨天及更早的旧日程 |
| `/plan delete <ID或序号>` | 删除指定目标 |
| `/plan help` | 显示帮助信息 |

## ⚙️ 配置说明

配置文件位置：`config.toml`

### 基础配置

```toml
[plugin]
enabled = true  # 是否启用插件

[autonomous_planning]
interval = 300  # 检查间隔（秒），默认5分钟
max_actions_per_cycle = 3  # 每周期最多执行的行动数量
enable_llm_planning = false  # 是否启用LLM智能规划（实验性）
```

### 日程注入配置

```toml
[autonomous_planning.schedule]
inject_schedule = true  # 是否在对话时自动提到当前活动（推荐开启）
```

**效果示例：**
- 用户："在干嘛？"
- 麦麦："这会儿正吃午饭呢"

### 清理配置

```toml
[autonomous_planning]
cleanup_interval = 3600  # 清理检查间隔（秒），默认1小时
cleanup_old_goals_days = 30  # 保留多少天的历史记录
```

### 个性化偏好（可选）

生成日程时可以通过对话方式指定偏好，例如：
```
"帮我生成今天的日程，我今天要上课"
"生成日程，多安排点学习时间"
```

## 📁 文件结构

```
autonomous_planning_plugin/
├── README.md              # 本文档
├── config.toml            # 配置文件
├── plugin.py              # 插件主文件
├── _manifest.json         # 插件清单
├── planner/               # 核心规划模块
│   ├── goal_manager.py           # 目标管理器
│   ├── schedule_generator.py     # 日程生成器
│   └── auto_schedule_manager.py  # 自动调度管理器
├── actions/               # 行动模块
│   └── schedule_action.py        # 日程执行动作
├── utils/                 # 工具模块
│   └── schedule_image_generator.py  # 日程图片生成器
└── data/                  # 数据目录
    └── goals.json                # 日程目标数据
```

## 💡 使用技巧

### 1. 每天清理旧日程
```bash
/plan clear  # 保持目标列表整洁
```

### 2. 快速查看当前活动
```bash
/plan status  # 查看简洁格式，快速了解安排
```

### 3. 查看完整描述
```bash
/plan list  # 查看图片格式，包含详细说明
```

### 4. 自然对话交互
```
"今天有什么安排"
"现在应该做什么"
"帮我重新规划今天的日程"
```

## 🔧 工作原理

### 日程生成流程

```
触发生成（对话或自动）
    ↓
检查是否已有今日日程
    ↓
调用 LLM 生成个性化日程
    ↓
批量保存到 goals.json
    ↓
注入到对话系统
```

### 日程筛选逻辑

- `/plan status` 和 `/plan list` 只显示**今天创建**的日程
- 通过 `created_at` 字段判断日期
- 自动过滤历史日程，避免混乱

### 日程清理机制

- 手动：使用 `/plan clear` 命令
- 自动：后台定期清理超过30天的已完成/已取消目标
- 清理时保留今天的所有日程

## ❓ 常见问题

**Q: 如何修改日程内容？**
A: 对麦麦说"重新生成今天的日程"，或使用 `/plan delete` 删除后重新生成

**Q: 为什么看不到日程？**
A:
1. 检查是否生成了日程（对麦麦说"生成今天的日程"）
2. 确认是否误清理了日程（`/plan clear` 会删除旧日程）

**Q: 如何禁用日程注入？**
A: 在 `config.toml` 中设置 `inject_schedule = false`

**Q: 日程会自动生成吗？**
A: 需要通过对话触发生成，插件会智能判断是否需要生成（避免重复）

**Q: 如何查看历史日程？**
A: 当前版本只显示今天的日程，历史日程会自动清理

## 🎯 优化亮点

### 代码优化
- ✅ 消除重复代码 70%+
- ✅ 新增 4 个辅助方法提升可维护性
- ✅ 统一的日程筛选和排序逻辑
- ✅ 向后兼容新旧数据格式

### 功能增强
- ✅ 新增 `clear` 命令清理旧日程
- ✅ 优化用户提示信息
- ✅ 改进帮助文档
- ✅ 只显示当天日程，避免混乱

### 性能提升
- ✅ 批量保存目标（减少 I/O 操作）
- ✅ 智能缓存机制
- ✅ 高效的日期筛选逻辑

## 📝 版本信息

**当前版本：** 2.1.0 (优化版)

**更新日志：**
- [2024-11] 代码重构，消除重复代码
- [2024-11] 新增 clear 命令
- [2024-11] 优化日程显示逻辑（只显示当天）
- [2024-11] 改进用户提示和帮助文档

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

请查看 LICENSE 文件

---

**享受麦麦的个性化日程！** 🎉
